<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<th:block th:replace="~{layout/head :: head}"></th:block>

<style>
    .container {
        max-width: 600px;
        margin: 0 auto;
    }
    .field {
        margin-bottom: 16px;
    }
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 6px;
    }
    input, textarea {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
    }
    .actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
    }
    .submit-btn {
        padding: 10px 16px;
        background: #222;
        color: white;
        border: none;
        cursor: pointer;
    }
    .cancel-btn {
        background: #ddd;
        text-decoration: none;
        color: black;
        display: inline-flex;
        align-items: center;
        padding: 10px 16px;
    }
</style>

<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<div class="container">
    <h1>Create Team</h1>

    <form th:action="@{/team/create}" method="post" th:object="${form}">
        <div class="field">
            <label for="name">Name</label>
            <input type="text" id="name" th:field="*{name}" required>
        </div>

        <div class="field">
            <label for="displayOrder">Display Order</label>
            <input type="number" id="displayOrder" th:field="*{displayOrder}" min="0" step="1" required>
        </div>


        <div class="field">
            <label for="description">Description</label>
            <textarea id="description" rows="5" th:field="*{description}"></textarea>
        </div>

        <div class="field">
            <label for="iconFile">Icon (Thumbnail)</label>

            <input id="iconFile" type="file" accept="image/*"/>

            <button type="button" id="uploadIconBtn" class="submit-btn" style="margin-top:10px;">
                Upload Icon
            </button>

            <div style="margin-top:12px;">
                <img id="iconPreview" src="" alt="" style="display:none; max-width:100%; border:1px solid #ddd; border-radius:6px;"/>
            </div>

            <!-- ⭐ 업로드된 S3 URL을 icon 필드로 제출 -->
            <input type="hidden" th:field="*{icon}" id="iconUrl"/>
        </div>


        <div class="actions">
            <button type="submit" class="submit-btn">Create</button>
            <a th:href="@{/team/list}" class="cancel-btn">Cancel</a>
        </div>
    </form>
</div>

<th:block th:replace="~{layout/footer :: footer}"></th:block>
<script>
    const fileInput = document.getElementById('iconFile');
    const uploadBtn = document.getElementById('uploadIconBtn');
    const preview = document.getElementById('iconPreview');
    const hiddenUrl = document.getElementById('iconUrl');

    uploadBtn.addEventListener('click', async () => {
        const file = fileInput.files?.[0];
        if (!file) {
            alert('아이콘 파일을 선택해줘');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        uploadBtn.disabled = true;
        uploadBtn.textContent = 'Uploading...';

        try {
            const res = await fetch('/api/upload/thumbnail', {
                method: 'POST',
                body: formData
            });

            if (!res.ok) {
                const text = await res.text();
                throw new Error(text || 'Upload failed');
            }

            const data = await res.json(); // { url: "..." }
            hiddenUrl.value = data.url;

            preview.src = data.url;
            preview.style.display = 'block';

            uploadBtn.textContent = 'Uploaded ✅';
        } catch (e) {
            console.error(e);
            alert('업로드 실패: ' + (e?.message ?? e));
            uploadBtn.textContent = 'Upload Icon';
        } finally {
            uploadBtn.disabled = false;
        }
    });
</script>

</body>
</html>
