<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="layout/head :: head"></head>
<body>

<div class="container mt-5" th:with="isNew=${post.id} == null">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 th:text="${isNew} ? '새 게시글 작성' : '게시글 수정'"></h2>
        <a class="btn btn-outline-dark" th:href="@{/post/list}">목록</a>
    </div>

    <!-- 새 글이면 /post/create, 수정이면 /post/update?id=... -->
    <form th:action="${isNew} ? @{/post/create} : @{/post/update(id=${post.id})}"
          method="post">

        <div class="mb-3">
            <label for="title" class="form-label">제목</label>
            <input type="text"
                   id="title"
                   name="title"
                   class="form-control"
                   th:value="${post.title}"
                   required>
        </div>

        <div class="mb-3">
            <label for="summary" class="form-label">요약</label>
            <input type="text"
                   id="summary"
                   name="summary"
                   class="form-control"
                   th:value="${post.summary}">
        </div>

        <div class="mb-3">
            <label for="author" class="form-label">작성자</label>
            <input type="text"
                   id="author"
                   name="author"
                   class="form-control"
                   th:value="${post.author}">
        </div>

        <div class="mb-3">
            <label for="content" class="form-label">내용</label>
            <textarea id="content"
                      name="content"
                      rows="12"
                      class="form-control"
                      th:text="${post.content}"></textarea>
        </div>

        <!-- 태그 선택 영역 (priority 숫자는 여기선 안 다룸) -->
        <div class="mb-4">
            <label class="form-label">태그</label>
            <div class="border rounded p-2" style="max-height: 220px; overflow-y: auto;">
                <div class="form-check"
                     th:each="tag : ${allTags}">
                    <input class="form-check-input"
                           type="checkbox"
                           name="tagIds"
                           th:id="${'tag-' + tag.id}"
                           th:value="${tag.id}"
                           th:checked="${
                               post != null and
                               #lists.contains(post.postTags.![tag.id], tag.id)
                           }">
                    <label class="form-check-label"
                           th:for="${'tag-' + tag.id}"
                           th:text="${tag.name}"></label>
                </div>

                <div th:if="${#lists.isEmpty(allTags)}" class="text-muted">
                    등록된 태그가 없습니다. 먼저 태그를 생성해 주세요.
                </div>
            </div>
            <small class="text-muted d-block mt-1">
                ※ 태그 우선순위(노출 순서)는 상세 화면에서 수정 가능합니다.
            </small>
        </div>

        <div class="d-flex justify-content-end gap-2">
            <a class="btn btn-outline-secondary" th:href="@{/post/list}">취소</a>
            <button type="submit" class="btn btn-primary"
                    th:text="${isNew} ? '작성하기' : '수정하기'"></button>
        </div>
    </form>
</div>

<div th:replace="layout/footer :: footer"></div>
</body>
</html>
