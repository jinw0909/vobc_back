<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<th:block th:replace="~{layout/head :: head}"></th:block>
<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<div class="container mt-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            <span class="text-primary" th:text="${tag.name}"></span>
            태그의 관련 글 목록
        </h2>

        <a th:href="@{/tag/detail(id=${tag.id})}" class="btn btn-outline-primary">
            ← 태그 상세로 돌아가기
        </a>
    </div>

    <!-- If no posts (Page<Post> 기준) -->
    <div th:if="${posts.empty}" class="alert alert-info">
        이 태그와 연결된 게시글이 없습니다.
    </div>

    <!-- Post List -->
    <div th:if="${!posts.empty}" class="list-group">

        <a th:each="post : ${posts}"
           th:href="@{/post/detail(id=${post.id})}"
           class="list-group-item list-group-item-action">

            <h5 class="mb-1" th:text="${post.title}">게시글 제목</h5>

            <p class="mb-1 text-muted" th:text="${post.summary}">게시글 요약</p>

            <small>
                작성자: <span th:text="${post.author}"></span> ·
                작성일:
                <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
            </small>

        </a>

    </div>

    <!-- Pagination (/tag/{tagId}/posts 기준) -->
    <nav th:if="${posts.totalPages > 1}" class="mt-4" aria-label="Page navigation">
        <ul class="pagination justify-content-center">

            <!-- Prev -->
            <li class="page-item" th:classappend="${posts.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/tag/{tagId}/posts(tagId=${tag.id}, page=${posts.number - 1}, size=${posts.size})}"
                   aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            <!-- Page numbers (현재 페이지 기준 -2 ~ +2) -->
            <li class="page-item"
                th:each="p : ${#numbers.sequence(
                    T(java.lang.Math).max(0, posts.number - 2),
                    T(java.lang.Math).min(posts.totalPages - 1, posts.number + 2)
                )}"
                th:classappend="${p == posts.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/tag/{tagId}/posts(tagId=${tag.id}, page=${p}, size=${posts.size})}"
                   th:text="${p + 1}">1</a>
            </li>

            <!-- Next -->
            <li class="page-item" th:classappend="${posts.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/tag/{tagId}/posts(tagId=${tag.id}, page=${posts.number + 1}, size=${posts.size})}"
                   aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>

        </ul>

        <!-- Summary -->
        <div class="text-center text-muted mt-2" style="font-size: 0.9rem;">
            총 <span th:text="${posts.totalElements}"></span>개 ·
            <span th:text="${posts.number + 1}"></span>/<span th:text="${posts.totalPages}"></span> 페이지
        </div>
    </nav>

</div>

<th:block th:replace="~{layout/footer :: footer}"></th:block>
</body>
</html>
